{% extends 'base.html' %}

{% load staticfiles %}
{% load materializecss %}

{% block title %}{{ bug.title }}{% endblock %}

{% block content %}

    <div class="row bug-cards">
        <div class="col s12">
            <!-- Bug detail card -->
            <div class="card">
                <div class="card-content purple lighten-4">
                    <div class="row">
                        <div class="col s12">
                            <ul>
                                <li class="card-title">{{ bug.title }}</li>
                                {% if request.user == bug.author %}
                                    <li class="card-heading-icon left">
                                        <a href="{% url "bug_edit" bug.id %}"
                                           class="btn-floating btn waves-effect waves-light purple tooltipped"
                                           data-position="bottom"
                                           data-tooltip="Edit My Bug">
                                            <i class="material-icons">border_color</i>
                                        </a>
                                    </li>
                                    <li class="card-heading-icon left">
                                        <a href="{% url 'bug_delete' bug.id %}"
                                           class="btn-floating btn waves-effect waves-light red tooltipped"
                                           data-position="bottom" data-tooltip="Delete My Bug">
                                            <i class="material-icons">delete</i>
                                        </a>
                                    </li>
                                {% endif %}
                                <!-- Vote button and badge -->
                                <li class="card-heading-icon right">
                                    {% with total_votes=bug.votes.count users_vote=bug.votes.all %}
                                        <a href="#" data-id="{{ bug.id }}"
                                           data-action="{% if request.user in users_vote %}un{% endif %}vote"
                                           class="vote btn-floating btn waves-effect waves-light tooltipped purple"
                                           data-position="bottom" data-tooltip="Vote for Bug">
                                            <i class="vote-icon material-icons right">
                                                {% if request.user not in users_vote %}thumb_up{% else %}
                                                    thumb_down{% endif %}</i>
                                        </a>
                                        <span class="badge new vote-count purple" data-badge-caption="">
                                        <span class="total">{{ total_votes }}</span>
                                        vote{{ total_votes|pluralize }}
                                    </span>
                                    {% endwith %}
                                </li>
                            </ul>
                        </div>

                    </div>
                </div>
                <div class="card-action">
                    <h6><strong>Description:</strong></h6>
                    <p>{{ bug.description }}</p>
                </div>
                <div class="card-action">
                    <p>Current status: {{ bug.status }}</p>
                    <p>Created by: <strong>{{ bug.author }}</strong>, on {{ bug.created }}</p>
                </div>
            </div>

            <!-- Comment cards -->
            {% for comment in comments %}

                <div class="card">
                    <div class="card-content blue lighten-2">
                        <span class="card-title">Comment from <em>{{ comment.author }}</em>,
                            <small>created on: {{ comment.created }}</small></span>
                    </div>
                    <div class="card-action">
                        <p>{{ comment.comment|linebreaks }}</p>
                    </div>
                </div>
            {% empty %}
                <p>There are no comments yet... how sad :-(</p>

            {% endfor %}

            {% include 'pagination.html' with page=comments %}

            <h4>Add a new comment</h4>
            <form action="." method="POST">
                {{ bug_comment_form|materializecss }}
                {% csrf_token %}
                <button class="btn waves-effect waves-light" type="submit" value="Add comment">Add comment
                    <i class="material-icons right">send</i>
                </button>
            </form>

        </div>
    </div>

{% endblock %}